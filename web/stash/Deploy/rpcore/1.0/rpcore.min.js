/*
 *  $Copyright-Start$
 *
 *  Copyright (c) 2013
 *  RedPrairie Corporation
 *  All Rights Reserved
 *
 *  This software is furnished under a corporate license for use on a
 *  single computer system and can be copied (with inclusion of the
 *  above copyright) only for use on such a system.
 *
 *  The information in this document is subject to change without notice
 *  and should not be construed as a commitment by RedPrairie Corporation.
 *
 *  RedPrairie Corporation assumes no responsibility for the use of the
 *  software described in this document on equipment which has not been
 *  supplied or approved by RedPrairie Corporation.
 *
 *  $Copyright-End$
 */

RP.globals=RP.globals||{};RP.stash.api.beginLoadLib();
function printStackTrace(){return[];}
Ext.onReady(function(){RP.locale.Dispatch.includeLocalePack("rpext");RP.locale.Dispatch.includeLocalePack("ext");RP.locale.Dispatch.includeLocalePack("components");RP.locale.Dispatch.includeLocalePack("exceptions");RP.locale.Dispatch.includeLocalePack("login");RP.locale.Dispatch.includeLocalePack("misc");});
Ext.ns("RP.core");RP.core.ApplicationSites=function(){var appMetaData={};function getApplication(applicationId){for(var app in appMetaData){if(app.toLowerCase()===applicationId.toLowerCase()){return appMetaData[app];}}
return undefined;}
function getClientSite(applicationId,siteId){var application=appMetaData[applicationId];if(Ext.isArray(application)){for(var i=0;i<application.length;i++){var clientSite=application[i];if(clientSite.siteId===siteId){return clientSite;}}}
return null;}
function compareString(stringA,stringB){var a=stringA.toLowerCase();var b=stringB.toLowerCase();if(a<b){return-1;}
else if(a>b){return 1;}
return 0;}
return{setApps:function(applicationMetaData){appMetaData=applicationMetaData;},getAllSiteIds:function(){var allSiteIds=[];var clientSites;for(var application in appMetaData){clientSites=appMetaData[application];if(Ext.isArray(clientSites)){for(var i=0;i<clientSites.length;i++){allSiteIds.push(clientSites[i].siteId);}}}
return this.sortSiteIds(Ext.unique(allSiteIds));},sortSiteIds:function(uniqueSites){var numberSites=[],stringSites=[];for(var j=0;j<uniqueSites.length;j++){var site=uniqueSites[j];if(Ext.isNumber(parseInt(site,10))){numberSites.push(site);}
else{stringSites.push(site);}}
numberSites.sort(function(a,b){var parsedA=parseInt(a,10),parsedB=parseInt(b,10);if(parsedA===parsedB&&a!==b){return compareString(a.replace(parsedA.toString(),""),b.replace(parsedB.toString(),""));}
return parsedA-parsedB;});stringSites.sort(compareString);return numberSites.concat(stringSites);},getNativeId:function(applicationId,siteId){var clientSite=getClientSite(applicationId,siteId);if(clientSite!==null){return clientSite.nativeId;}
return null;},getSessionKeepAliveUrl:function(){var pageUrl=RP.core.PageContext.getPageUrl();return pageUrl+this.buildDataServiceUrl("rp","admin/sessionKeepAlive");},buildDataServiceUrl:function(appId,bean,params){var globalSiteId=RP.globals.getValue("SITEID");var serverName=RP.location.DEFAULT_NONE;var siteId=RP.location.DEFAULT_NONE;var application=getApplication(appId);if(Ext.isDefined(application)){var clientSite=getClientSite(appId,globalSiteId);var potentialSiteId=RP.core.ApplicationSites.getNativeId(appId,globalSiteId);if(Ext.isDefined(potentialSiteId)){siteId=potentialSiteId;}
if(clientSite!==null&&siteId!==null){serverName=clientSite.server;}}
params=params||{};var siteName=(serverName!==RP.location.DEFAULT_NONE?serverName:globalSiteId);var url=RP.globals.getFullyQualifiedPath("PATH_TO_DATA_ROOT");if(appId==="rp"){url+=appId;}
else if(params.siteName){url+=params.siteName;}
else{url+=siteName;}
url+="/"+bean;if(!params.siteId&&siteId!==RP.location.DEFAULT_NONE){params.siteId=siteId;}
var sundial=RP.core.Sundial||Sundial;if(sundial.hasOffset()){params.demoDate=sundial.now().format("c");}
url=Ext.urlAppend(url,Ext.urlEncode(params));return url;},buildWebUrl:function(appId,path){if(path.charAt(0)=='/'){path=path.substring(1);}
var url=RP.globals.paths.STATIC+appId+"/"+path;return url;}};}();RP.buildDataServiceUrl=RP.core.ApplicationSites.buildDataServiceUrl;RP.buildWebUrl=RP.core.ApplicationSites.buildWebUrl;RP.getSessionKeepAliveUrl=RP.core.ApplicationSites.getSessionKeepAliveUrl;
Ext.ns("RP.core");RP.core.PageContext=(function(){var CONTEXT_TOKEN=":";var refreshOnModuleContextChange=true;function getRootUrl(){var baseUrl=RP.globals.getPath("BASE_URL");if(!Ext.isEmpty(baseUrl)){return baseUrl;}
return String.format("{0}//{1}",window.location.protocol,window.location.host);}
function getPageRootPath(moduleName,siteId){if(!Ext.isDefined(siteId)){siteId=RP.globals.getValue("SITEID");}
var siteIdStr=String.format("/{0}",encodeURIComponent(siteId));var rootPath=String.format("{0}{1}/{2}",RP.globals.getFullyQualifiedPath("PB_ROOT"),siteIdStr,moduleName);if(rootPath.indexOf("http")!==0){rootPath=getRootUrl()+rootPath;}
return rootPath;}
function setLocationToModule(moduleName,moduleContext){var moduleContextStr=moduleContext?Ext.urlEncode(moduleContext):"";RP.util.Helpers.redirect(String.format("{0}#/{1}",getPageRootPath(moduleName),moduleContextStr));}
function getValidContextProperties(obj){var ret={};Ext.iterate(obj,function(key,value){if(Ext.isPrimitive(value)){ret[key]=value;}});return ret;}
function getContextAsUrl(moduleContext,taskflowContext,taskContext){var moduleCtx=moduleContext?Ext.urlEncode(getValidContextProperties(moduleContext)):"";var taskflowCtx=taskflowContext?Ext.urlEncode(getValidContextProperties(taskflowContext)):"";var taskCtx=taskContext?Ext.urlEncode(getValidContextProperties(taskContext)):"";if(!Ext.isEmpty(moduleCtx)||!Ext.isEmpty(taskflowCtx)||!Ext.isEmpty(taskCtx)){return String.format("/{0}/{1}/{2}",moduleCtx,taskflowCtx,taskCtx);}
return"";}
function parseUrl(hash){if(!Ext.isDefined(hash)||hash===null){hash="";}
var parts=hash.split("/");var tfNav=parts[0].split(CONTEXT_TOKEN);var moduleCtx={},taskflowCtx={},taskCtx={};if(!Ext.isEmpty(parts[1])){moduleCtx=Ext.urlDecode(parts[1]);}
if(parts.length>2){taskflowCtx=Ext.urlDecode(parts[2]);}
if(parts.length>3){taskCtx=Ext.urlDecode(parts[3]);}
return{tfName:tfNav[0]||"",taskID:tfNav[1]||"",moduleContext:moduleCtx,taskflowContext:taskflowCtx,taskContext:taskCtx};}
function createUrlHash(taskflowName,taskName,moduleContext,taskflowContext,taskContext){var ctxUrl=getContextAsUrl(moduleContext,taskflowContext,taskContext)||"";taskName=taskName||"";taskflowName=taskflowName||"";return String.format("{0}{1}{2}{3}",taskflowName,CONTEXT_TOKEN,taskName,ctxUrl);}
return{isRefreshOnModuleContextChange:function(){return refreshOnModuleContextChange;},encodeContextAsHashValue:function(ctx){return Ext.urlEncode(getValidContextProperties(ctx));},parseHash:function(hash){return parseUrl(hash);},getPageUrl:function(){return getRootUrl();},getActiveModuleName:function(){var urlPathName=window.location.pathname;var urlPath=urlPathName.split("/");var moduleName=urlPath[urlPath.length-1];if(moduleName!=="rp"&&moduleName!==RP.globals.SITEID){return moduleName;}
return null;},determineModule:function(moduleName){var modules=RP.taskflow.ModuleRegistry.getAllSorted();var activeModuleName=this.getActiveModuleName();if(!moduleName&&activeModuleName){moduleName=activeModuleName;}
else if(!moduleName&&modules.length>0){moduleName=modules[0].name;}
var activeModule=RP.taskflow.ModuleRegistry.get(moduleName);if(activeModule===undefined&&modules.length>0){activeModule=RP.taskflow.ModuleRegistry.get(modules[0].name);var url=RP.core.PageContext.getPageURL(RP.globals.SITEID,modules[0].name);RP.util.Helpers.redirect(url);}
RP.globals.CURRENT_MODULE=activeModule;return activeModuleName;},setActiveModule:function(moduleName,moduleContext){var currentModuleName=RP.globals.CURRENT_MODULE.name;var activeModuleName=this.determineModule(moduleName);if(!moduleContext&&RP.globals.CURRENT_MODULE&&moduleName===currentModuleName&&RP.globals.CURRENT_HASH&&RP.globals.CURRENT_HASH.moduleContext){moduleContext=RP.globals.CURRENT_HASH.moduleContext;}
if(Ext.isDefined(activeModuleName)&&activeModuleName!=moduleName){setLocationToModule(moduleName,moduleContext);}
else{RP.util.Helpers.reload(100);}},setInitialURL:function(siteId,moduleName){RP.globals.SITEID=siteId;RP.location={};RP.location.DEFAULT_NONE='NONE';RP.util.Helpers.redirect(getPageRootPath(moduleName,siteId));},getActiveTaskflowName:function(){var urlTokens=window.location.hash.split(CONTEXT_TOKEN);if(urlTokens.length>0){return urlTokens[0].replace(/^#/,"");}
return null;},getActiveTaskName:function(){var urlTokens=window.location.hash.split(CONTEXT_TOKEN);if(urlTokens.length>1){return urlTokens[1].replace(/\/.*$/,"");}
return null;},getTaskHash:function(taskflowName,taskID,taskflowContext,taskContext){var currCtx=parseUrl(window.location.hash);var newHash=createUrlHash(taskflowName,taskID,currCtx.moduleContext,taskflowContext,taskContext);return newHash;},getModuleContext:function(){var currCtx=parseUrl(window.location.hash);return currCtx.moduleContext;},updateModuleContext:function(moduleContext,refreshBrowser){if(!Ext.isEmpty(refreshBrowser)){refreshOnModuleContextChange=refreshBrowser;}
var currCtx=parseUrl(window.location.hash);var newHash=createUrlHash(currCtx.tfName,currCtx.taskID,moduleContext,currCtx.taskflowContext,currCtx.taskContext);Ext.History.add(newHash,true);},updateTaskflowContext:function(taskflowContext){var currCtx=parseUrl(window.location.hash);var newHash=createUrlHash(currCtx.tfName,currCtx.taskID,currCtx.moduleContext,taskflowContext,currCtx.taskContext);Ext.History.add(newHash,true);},updateTaskContext:function(taskContext){var currCtx=parseUrl(window.location.hash);var newHash=createUrlHash(currCtx.tfName,currCtx.taskID,currCtx.moduleContext,currCtx.taskflowContext,taskContext);if(newHash){Ext.History.add(newHash,true);}},getPageURL:function(siteId,moduleName,taskflowName,taskName,moduleCtx,taskflowCtx,taskCtx){return String.format("{0}#{1}",getPageRootPath(moduleName,siteId),createUrlHash(taskflowName,taskName,moduleCtx,taskflowCtx,taskCtx));},openWindow:function(url,name,options){var opt=[];options=options||{};name=name||new Date().getTime().toString();Ext.iterate(options,function(key,value){opt.push(String.format("{0}={1}",key,value?1:0));});return window.open(url,name,opt.toString());},redirect:function(url,millis){RP.util.Helpers.redirect(url,millis);}};})();
Ext.ns("RP.upb");RP.core.SessionSecurity=(function(){function startTimerFn(){RP.util.PageInactivityChecker.start(60*RP.globals.getValue("INACTIVITY_TIMEOUT_MINUTES"));}
function inactivityWarningFn(){RP.event.AppEventManager.fire(RP.upb.AppEvents.Inactive,{});var dlg=new RP.ui.InactivityWarningDialog();RP.event.AppEventManager.register(RP.upb.AppEvents.ActiveAgain,startTimerFn);dlg.show();}
function terminatedSession(){if(!Ext.getCmp("sessionExpiredDialog")&&!Ext.getCmp("externalAuthenticationExpiredDialog")){Ext.getBody().maskEx();var dialog;if(!RP.util.Helpers.isNativeLogin()){dialog=new RP.ui.ExternalAuthenticationExpiredDialog();}
else{dialog=new RP.ui.SessionExpiredDialog();}
dialog.on("destroy",function(){Ext.getBody().unmask();});dialog.show();}}
function clearDirtyPageChecks(){if(Ext.isFunction(window.onbeforeunload)){window.onbeforeunload=null;}}
Ext.Ajax.on("sessionterminated",terminatedSession,this);Ext.Ajax.on("sessionterminated",clearDirtyPageChecks,this);if(Ext.isString(RP.globals.paths.REAUTHENTICATE)&&Ext.isNumber(parseInt(RP.globals.INACTIVITY_TIMEOUT_MINUTES,10))&&RP.globals.INACTIVITY_TIMEOUT_MINUTES>0){RP.util.PageInactivityChecker.addHandler(inactivityWarningFn);startTimerFn();}})();
Ext.namespace("RP.upb");RP.upb.AppEvents={Inactive:"rp.upb.inactive",ActiveAgain:"rp.upb.activeAgain",ModuleContextChanged:"rp.ub.moduleCtxChanged",BeforeSessionExpired:"rp.upb.beforeSessionExpired",SessionExpired:"rp.upb.sessionExpired",SessionReauthenticated:"rp.upb.sessionReauthenticated",KeepAlive:"rp.upb.keepAlive",KeepAliveSuccess:"rp.upb.keepAliveSuccess",KeepAliveFailure:"rp.upb.keepAliveFailure"};
Ext.ns("RP.upb");RP.upb.ChangeSiteWindow=Ext.extend(Ext.Window,{initComponent:function(){this.siteStore=this.createSiteStore();this.siteComboBox=this.createSiteComboBox();this.siteComboBox.setValue(RP.globals.SITEID);Ext.apply(this,{title:RP.getMessage("rp.common.changesite.FormTitle"),width:450,draggable:false,resizable:false,closable:false,modal:true,padding:20,items:[{xtype:"panel",layout:"centeredform",itemId:"form",bodyStyle:"background-color: #fff",border:false,items:[this.siteComboBox,{xtype:"checkbox",itemId:"chkNewWindow",boxLabel:RP.getMessage("rp.common.changesite.OpenInNewWindow")}],buttonAlign:"center",buttons:[{itemId:"btnSelect",text:RP.getMessage("rp.common.changesite.SelectButton"),handler:this.onSelect,scope:this},{itemId:"btnCancel",text:RP.getMessage("rp.common.changesite.CancelButton"),handler:this.close,scope:this}]}]});RP.upb.ChangeSiteWindow.superclass.initComponent.call(this);},createSiteStore:function(){var sites=RP.core.ApplicationSites.getAllSiteIds();var data=[];Ext.each(sites,function(site){data.push([site]);});return new Ext.data.ArrayStore({fields:["siteId"],data:data});},createSiteComboBox:function(){return new Ext.form.ComboBox({xtype:"combo",fieldLabel:RP.getMessage("rp.common.changesite.CurrentSite"),store:this.siteStore,displayField:"siteId",valueField:"siteId",itemId:"currentSite",typeAhead:true,mode:"local",forceSelection:true,triggerAction:"all",selectOnFocus:true,labelStyle:"font-weight: bold",listeners:{specialkey:this.onSpecialKey,scope:this}});},changeSite:function(siteId,newWindow){var url=RP.core.PageContext.getPageURL(siteId,RP.core.PageContext.getActiveModuleName());if(newWindow===true){RP.core.PageContext.openWindow(url);}
else{RP.util.Helpers.redirect(url);}
this.close();},onSelect:function(){var siteId=this.siteComboBox.getValue();var newWindow=this.getComponent("form").getComponent("chkNewWindow").getValue();this.changeSite(siteId,newWindow);},onSpecialKey:function(field,e){if(e.getKey()==e.ENTER&&field.findRecord(field.valueField,field.getValue())){e.stopEvent();this.onSelect();}}});
Ext.ns("RP.upb");RP.upb.FormTitle=function(config){if(!config.titleText){return;}
function createHTML(title){return String.format('<div class="rp-header-page-title"><div class="rp-h2bullet"></div><div id="__pageTitle">{0}</div></div>',title);}
var html=createHTML(config.titleText);RP.upb.FormTitle.superclass.constructor.call(this,{border:false,html:html});this.setTitleHTML=function(html){var lbl=Ext.get("__pageTitle");if(lbl){lbl.dom.innerHTML=html;}
else{this.html=createHTML(html);}};};Ext.extend(RP.upb.FormTitle,Ext.Panel);
Ext.ns("RP.upb");RP.upb.UnstableEnvironmentWindow=Ext.extend(Ext.Component,{id:"_rp-unstable-environment-window",show:function(){Ext.MessageBox.show({title:RP.getMessage("rp.common.misc.UnstableEnvironmentMessageTitle"),msg:RP.getMessage("rp.common.misc.UnstableEnvironmentMessageDescription"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.WARNING});},isVisible:function(){if(Ext.MessageBox.getDialog().title===RP.getMessage("rp.common.misc.UnstableEnvironmentMessageTitle")){return Ext.MessageBox.isVisible();}},close:function(){if(Ext.MessageBox.getDialog().title===RP.getMessage("rp.common.misc.UnstableEnvironmentMessageTitle")){Ext.MessageBox.hide();}}});RP.upb.UnstableEnvironmentWindow=new RP.upb.UnstableEnvironmentWindow();
Ext.ns("RP.upb");RP.upb.HeaderPanel=Ext.extend(Ext.Panel,{initComponent:function(){var demoDateHtml=this._getDemoDateHtml();var html='<div class="rp-header">'+'<div class="rp-header-logo"></div>'+'<div class="rp-header-nav">'+'<div class="rp-header-nav-top">'+'</div>'+
demoDateHtml+'</div>'+'</div>';this._formTitle=new RP.upb.FormTitle(this.initialConfig);var titleHtml=this._formTitle.html;var appHeader=new Ext.Panel({border:false,html:html});var extraPanel=new Ext.Panel({border:false,cls:"rp-form-title-extra",items:this.initialConfig.items});var exitLink;var exitLinkId="_rpExitLink";if(RP.upb.PageBootstrapper.isNativeLogin()===false){exitLink=new Ext.BoxComponent({autoEl:{tag:"a",href:RP.globals.getFullyQualifiedPath("LOGOUT"),html:RP.getMessage("rp.common.misc.Close")},cls:"rp-header-nav-link",id:exitLinkId});}
else{exitLink=new Ext.BoxComponent({autoEl:{tag:"a",href:RP.globals.getFullyQualifiedPath("LOGOUT"),html:RP.getMessage("rp.common.misc.Logout")},cls:"rp-header-nav-link",id:exitLinkId});}
var helpLink=this.createHelpLink();Ext.apply(this,{border:false,cls:"rp-header-outer",items:[appHeader,extraPanel,this._formTitle]});appHeader.on("afterrender",function(){this.displayHeaderNotification("_rp-headerNotification");this.addHeaderComponent(new RP.upb.UserComponent({externalAuthentication:this.externalAuthentication}));this.addHeaderComponent(this.getSiteComponent());this.addHeaderComponent(exitLink);this.addHeaderComponent(helpLink);},this);RP.upb.HeaderPanel.superclass.initComponent.call(this);},_getDemoDateHtml:function(){var demoDateHtml="";var sundial=RP.core.Sundial||Sundial;if(sundial.hasOffset()){var demoDateStr=sundial.now().formatDate(RP.core.Formats.Date.Long);demoDateHtml='<div class="rp-header-nav-bottom">'+'<span class="rp-header-demo-time">'+RP.getMessage("rp.common.misc.DemoDateLabel")+
demoDateStr+'</span>'+'</div>';}
return demoDateHtml;},displayHeaderNotification:function(renderToId){if(RP.globals.getValue("UNSTABLE")==="true"){this.addHeaderComponent(new RP.upb.HeaderNotification({id:renderToId}));}},setPageTitle:function(titleHTML){this._formTitle.setTitleHTML(titleHTML);},addHeaderComponent:function(component){if(!Ext.isEmpty(component)){var headerNav=Ext.DomQuery.selectNode(".rp-header .rp-header-nav-top");var separatorHtml='<span class="rp-header-nav-separator">|</span>';if(Ext.DomQuery.selectNode(".rp-header .rp-header-nav-top:has(*)")){Ext.DomHelper.insertHtml("beforeEnd",headerNav,separatorHtml);}
component.render(headerNav);}},createHelpLink:function(){var mainHelpURL=RP.globals.getPath('BASE_URL')+RP.globals.getValue('PATH_TO_ROOT')+"web/refs/help/main.htm";RP.help.HelpRegistry.setDefaultHelpURL(mainHelpURL);return RP.help.RoboHelpLink.createHelpLink({cls:"rp-header-nav-link"},mainHelpURL,RP.getMessage("rp.common.misc.HelpLinkLabel"),"rphelpwindow",this.helpMapper);},getSiteComponent:function(){var sites=RP.core.ApplicationSites.getAllSiteIds();var siteId=RP.globals.getValue("SITEID");if(!Ext.isEmpty(sites)){if(sites.length>1){return new RP.ui.Hyperlink({text:siteId,cls:"rp-header-nav-link",scope:this,handler:function(){var changeSiteWindow=new RP.upb.ChangeSiteWindow().show();}});}
else if(siteId!==RP.location.DEFAULT_NONE){return new Ext.form.Label({text:siteId});}}
return null;},helpMapper:function(){var currTask=RP.globals.CURRENT_TASK;if(!Ext.isDefined(currTask)){return null;}
var currTaskConfig=currTask.taskConfig;if(Ext.isFunction(currTaskConfig.helpMapperFn)){var taskMappedHelpUrl=currTaskConfig.helpMapperFn();if(!Ext.isEmpty(taskMappedHelpUrl)){return taskMappedHelpUrl;}}
var taskHelpUrl=currTaskConfig.helpUrl;var helpRootUrl=RP.help.HelpRegistry.getHelpRootURL(currTask.appId);if(taskHelpUrl.indexOf("http://")===0||taskHelpUrl.indexOf("https://")===0){return taskHelpUrl;}
if(Ext.isEmpty(taskHelpUrl)||Ext.isEmpty(helpRootUrl)){return null;}
return(helpRootUrl+taskHelpUrl);}});Ext.reg("rpheaderpanel",RP.upb.HeaderPanel);
Ext.ns("RP.upb");RP.upb.HeaderNotification=Ext.extend(Ext.Component,{initComponent:function(){Ext.apply(this,{autoEl:{tag:"a",href:["javascript",":void(0);"].join(""),html:RP.getMessage("rp.common.misc.UnstableEnvironmentWarning")}});if(RP.globals.getValue("SERVER_TYPE")==="production"){this.displayMessage();}
this.on("afterrender",this.attachClickHandler,this);RP.upb.HeaderNotification.superclass.initComponent.call(this);},attachClickHandler:function(){this.getEl().on("click",this.displayMessage,this);},displayMessage:function(){RP.upb.UnstableEnvironmentWindow.show();}});Ext.reg("rpheadernotification",RP.upb.HeaderNotification);
Ext.ns("RP.upb");RP.upb.UserComponent=Ext.extend(Ext.BoxComponent,{initComponent:function(){var userFullName=RP.globals.getValue("USER_FULL_NAME");Ext.apply(this,{id:"_rp-userName",autoEl:"span",html:RP.globals.getValue("DISPLAY_USER_FULLNAME")&&!Ext.isEmpty(userFullName)?userFullName:RP.globals.getValue("USERNAME")});this.on("afterrender",this.onAfterRender,this);RP.upb.UserComponent.superclass.initComponent.call(this);},onAfterRender:function(){if(!this.externalAuthentication){this.addMenu();}
else{this.removeDownArrow();}},addMenu:function(){var menu=new Ext.menu.Menu({id:"_rpUserMenu"});menu.addMenuItem({itemId:"changePassword",text:RP.getMessage("rp.common.changepassword.FormTitle"),handler:function(){var x=new RP.ui.ChangePassword();}});this.getEl().on("click",function(){menu.show(this,"bl");});},removeDownArrow:function(){this.getEl().set({id:""});}});
Ext.ns("RP.upb");RP.upb.Viewport=Ext.extend(Ext.Viewport,{initComponent:function(){var center={itemId:"_rp_center_panel",region:'center',border:false,layout:"fit",items:this.items,cls:'rp-center-panel'};var headerConfig=this.initialConfig.headerConfig;var title=(headerConfig.title)?headerConfig.title:"RedPrairie";var headerPanel={id:"_rp_header_panel",xtype:'rpheaderpanel',titleText:title,externalAuthentication:this.initialConfig.externalAuthentication};Ext.apply(headerPanel,this.initialConfig.headerConfig);var northHeight=55;var north={id:'_rp_north_panel',region:'north',split:false,height:northHeight,border:false,collapsible:false,layout:'fit',layoutConfig:{animate:true},items:[{border:false,iconCls:'nav',items:[headerPanel]}]};var viewportItems=[north,center];var northHidden=false;var northPanel=null;this.toggleHeaderPanel=function(){if(!northPanel){northPanel=Ext.getCmp("_rp_north_panel");}
if(northHidden){northPanel.setHeight(northHeight);northPanel.getEl().removeClass("viewinactive");}
else{northPanel.getEl().addClass("viewinactive");}
northHidden=!northHidden;};Ext.apply(this,{layout:'border',items:viewportItems});RP.upb.Viewport.superclass.initComponent.call(this);}});
Ext.ns("RP.upb");RP.upb.PageBootstrapper=(function(){var viewPortId="rpViewport";var externalAuthentication=false;var nativeLogin=true;var taskflowFrameItemId="taskflowFrame";function renderPage(config){externalAuthentication=config.externalAuthentication||false;nativeLogin=Ext.value(config.nativeLogin,true);var currentModule=config.currentModule||"";var modules=RP.taskflow.ModuleRegistry.getAllSorted();if(!Ext.isEmpty(currentModule)&&Ext.isString(currentModule)){RP.globals.CURRENT_MODULE=RP.taskflow.ModuleRegistry.get(currentModule);}
else{RP.core.PageContext.determineModule();}
var activeModule=RP.globals.CURRENT_MODULE;var taskflows=[];if(activeModule){logger.logInfo("[PageBootstraper] Loading module '"+activeModule.name+"'");var taskflowsEnabled=true;if(activeModule.taskflows.names){taskflowsEnabled=activeModule.taskflows.enabled;activeModule.taskflows=activeModule.taskflows.names;}
Ext.each(activeModule.taskflows,function(tfName){var tfDef=RP.taskflow.TaskflowRegistry.get(tfName);if(tfDef){taskflows.push({itemId:tfName,taskflow:tfName,title:tfDef.title,isTitleMessageName:tfDef.isTitleMessageName});}});}
var createViewportFn=function(){var viewport=new RP.upb.Viewport({id:viewPortId,externalAuthentication:externalAuthentication,items:[new RP.taskflow.TaskflowFrame({itemId:taskflowFrameItemId,navRegion:RP.globals.NAV_REGION,navTitle:activeModule?RP.getMessage(activeModule.label):"",taskflows:taskflows,taskflowsEnabled:taskflowsEnabled,modules:modules})],headerConfig:{}});viewport.render(document.body);};var moduleInitFn=Ext.emptyFn;if(activeModule){moduleInitFn=activeModule.initFn;}
if(Ext.isString(moduleInitFn)){var tmpInitFn=eval(moduleInitFn);if(Ext.isFunction(tmpInitFn)){moduleInitFn=tmpInitFn;}}
if(Ext.isDefined(activeModule)&&Ext.isFunction(moduleInitFn)){moduleInitFn.call(activeModule,createViewportFn);}
else{createViewportFn();}}
return{bootstrap:function(config){logger.setLogToServerURL(RP.globals.getFullyQualifiedPath("PATH_TO_DATA_ROOT")+"logToServer");if(config.logToServerInterval){logger.setLogToServerInterval(config.logToServerInterval);}
if(config.logToServerFlag){logger.setLogToServer(true,false);}
if(config.logMaxEntries){logger.setUIMaxEntries(config.logMaxEntries);}
logger.logTrace("[PageBootstrapper] bootstrap()...");Ext.onReady(function(){Ext.state.Manager.setProvider(new Ext.state.CookieProvider({expires:new Date(new Date().getTime()+(1000*60*60*24*365))}));RP.util.ScriptLoader.onReady(function(){renderPage(config);RP.event.AppEventManager.register(RP.upb.AppEvents.ModuleContextChanged,function(){RP.util.Helpers.reload(1);});});});},getTaskflowFrame:function(){return Ext.getCmp(viewPortId).find('itemId',taskflowFrameItemId)[0];},isExternallyAuthenticated:function(){return externalAuthentication;},isNativeLogin:function(){return nativeLogin;}};})();Ext.History.on("change",function(strHash){logger.logTrace("[PageContext] location change detected: "+strHash);if(RP.globals.CURRENT_HASH){var oldModuleCtxStr=Ext.urlEncode(RP.globals.CURRENT_HASH.moduleContext);var newHash=RP.core.PageContext.parseHash(strHash);if((Ext.urlEncode(newHash.moduleContext)!==oldModuleCtxStr)&&RP.core.PageContext.isRefreshOnModuleContextChange()){RP.event.AppEventManager.fire(RP.upb.AppEvents.ModuleContextChanged);}}});RP.getTaskflowFrame=RP.upb.PageBootstrapper.getTaskflowFrame;
RP.stash.api.endLoadLib();